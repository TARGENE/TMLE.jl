<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Walk Through · TMLE.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://TARGENE.github.io/TMLE.jl/walk_through/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/logo.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="TMLE.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">TMLE.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Walk Through</a><ul class="internal"><li><a class="tocitem" href="#The-Dataset"><span>The Dataset</span></a></li><li><a class="tocitem" href="#The-Structural-Causal-Model"><span>The Structural Causal Model</span></a></li><li><a class="tocitem" href="#The-Causal-Estimands"><span>The Causal Estimands</span></a></li><li><a class="tocitem" href="#Identification"><span>Identification</span></a></li><li><a class="tocitem" href="#Estimation"><span>Estimation</span></a></li><li><a class="tocitem" href="#Hypothesis-Testing"><span>Hypothesis Testing</span></a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../user_guide/scm/">Structural Causal Models</a></li><li><a class="tocitem" href="../user_guide/estimands/">Estimands</a></li><li><a class="tocitem" href="../user_guide/estimation/">Estimation</a></li><li><a class="tocitem" href="../user_guide/misc/">Miscellaneous</a></li></ul></li><li><span class="tocitem">Examples</span></li><li><a class="tocitem" href="../resources/">Resources</a></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Walk Through</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Walk Through</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/TARGENE/TMLE.jl/blob/main/docs/src/walk_through.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Walk-Through"><a class="docs-heading-anchor" href="#Walk-Through">Walk Through</a><a id="Walk-Through-1"></a><a class="docs-heading-anchor-permalink" href="#Walk-Through" title="Permalink"></a></h1><p>The goal of this section is to provide a comprehensive (but non-exhaustive) illustration of the estimation process provided in TMLE.jl. For an in-depth explanation, please refer to the User Guide.</p><h2 id="The-Dataset"><a class="docs-heading-anchor" href="#The-Dataset">The Dataset</a><a id="The-Dataset-1"></a><a class="docs-heading-anchor-permalink" href="#The-Dataset" title="Permalink"></a></h2><p>TMLE.jl is compatible with any dataset respecting the <a href="https://tables.juliadata.org/stable/">Tables.jl</a> interface, that is for instance, a <code>NamedTuple</code>, a <code>DataFrame</code>, an <code>Arrow.Table</code> etc... In this section, we will be working with the same dataset all along.</p><p>⚠️ One thing to note is that treatment variables as well as binary outcomes <strong>must</strong> be encoded as <code>categorical</code> variables in the dataset (see <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/working_with_categorical_data/">MLJ Working with categorical data</a>).</p><p>The dataset is generated as follows:</p><pre><code class="language-julia hljs">using TMLE
using Random
using Distributions
using DataFrames
using StableRNGs
using CategoricalArrays
using TMLE
using LogExpFunctions
using MLJLinearModels

function make_dataset(;n=1000)
    rng = StableRNG(123)
    # Confounders
    W₁₁= rand(rng, Uniform(), n)
    W₁₂ = rand(rng, Uniform(), n)
    W₂₁= rand(rng, Uniform(), n)
    W₂₂ = rand(rng, Uniform(), n)
    # Covariates
    C = rand(rng, Uniform(), n)
    # Treatment | Confounders
    T₁ = rand(rng, Uniform(), n) .&lt; logistic.(0.5sin.(W₁₁) .- 1.5W₁₂)
    T₂ = rand(rng, Uniform(), n) .&lt; logistic.(-3W₂₁ - 1.5W₂₂)
    # Target | Confounders, Covariates, Treatments
    Y = 1 .+ 2W₂₁ .+ 3W₂₂ .+ W₁₁ .- 4C.*T₁ .- 2T₂.*T₁.*W₁₂ .+ rand(rng, Normal(0, 0.1), n)
    return DataFrame(
        W₁₁ = W₁₁,
        W₁₂ = W₁₂,
        W₂₁ = W₂₁,
        W₂₂ = W₂₂,
        C   = C,
        T₁  = categorical(T₁),
        T₂  = categorical(T₂),
        Y   = Y
        )
end
dataset = make_dataset()</code></pre><p>Even though the role of a variable (treatment, outcome, confounder, ...) is relative to the problem setting, this dataset can intuitively be decomposed into:</p><ul><li>1 Outcome variable (<span>$Y$</span>).</li><li>2 Treatment variables <span>$(T₁, T₂)$</span> with confounders <span>$(W₁₁, W₁₂)$</span> and <span>$(W₂₁, W₂₂)$</span> respectively.</li><li>1 Extra Covariate variable (<span>$C$</span>).</li></ul><h2 id="The-Structural-Causal-Model"><a class="docs-heading-anchor" href="#The-Structural-Causal-Model">The Structural Causal Model</a><a id="The-Structural-Causal-Model-1"></a><a class="docs-heading-anchor-permalink" href="#The-Structural-Causal-Model" title="Permalink"></a></h2><p>The modeling stage starts from the definition of a Structural Causal Model (<code>SCM</code>). This is simply a list of Structural Equations (<code>SE</code>) describing the relationships between the random variables associated with our problem. See <a href="../user_guide/scm/#Structural-Causal-Models">Structural Causal Models</a> for an in-depth explanation. For our purposes, we will simply define it as follows:</p><pre><code class="language-julia hljs">scm = SCM(
    :Y  =&gt; [:T₁, :T₂, :W₁₁, :W₁₂, :W₂₁, :W₂₂, :C],
    :T₁ =&gt; [:W₁₁, :W₁₂],
    :T₂ =&gt; [:W₂₁, :W₂₂]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta graph based on a Graphs.SimpleGraphs.SimpleDiGraph{Int64} with vertex labels of type Symbol, vertex metadata of type Nothing, edge metadata of type Nothing, graph metadata given by nothing, and default weight 1.0</code></pre><h2 id="The-Causal-Estimands"><a class="docs-heading-anchor" href="#The-Causal-Estimands">The Causal Estimands</a><a id="The-Causal-Estimands-1"></a><a class="docs-heading-anchor-permalink" href="#The-Causal-Estimands" title="Permalink"></a></h2><p>From the previous causal model we can ask multiple causal questions which are each represented by distinct causal estimands. The set of available estimands types can be listed as follow:</p><pre><code class="language-julia hljs">AVAILABLE_ESTIMANDS</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Symbol}:
 :CM
 :IATE
 :ATE</code></pre><p>At the moment there are 3 main causal estimands in TMLE.jl, we provide below a few examples.</p><ul><li>The Counterfactual Mean:</li></ul><pre><code class="language-julia hljs">cm = CM(
    outcome = :Y,
    treatment_values = (T₁=true,)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TMLE.CausalCM(:Y, (T₁ = true,))
</code></pre><ul><li>The Average Treatment Effect:</li></ul><pre><code class="language-julia hljs">total_ate = ATE(
    outcome = :Y,
    treatment_values = (
        T₁=(case=1, control=0),
        T₂=(case=1, control=0)
    )
)
marginal_ate_t1 = ATE(
    outcome = :Y,
    treatment_values = (T₁=(case=1, control=0),)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TMLE.CausalATE(:Y, (T₁ = (case = 1, control = 0),))
</code></pre><ul><li>The Interaction Average Treatment Effect:</li></ul><pre><code class="language-julia hljs">iate = IATE(
    outcome = :Y,
    treatment_values = (
        T₁=(case=1, control=0),
        T₂=(case=1, control=0)
    )
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TMLE.CausalIATE(:Y, (T₁ = (case = 1, control = 0), T₂ = (case = 1, control = 0)))
</code></pre><h2 id="Identification"><a class="docs-heading-anchor" href="#Identification">Identification</a><a id="Identification-1"></a><a class="docs-heading-anchor-permalink" href="#Identification" title="Permalink"></a></h2><p>Identification is the process by which a Causal Estimand is turned into a Statistical Estimand, that is, a quantity we may estimate from data. This is done via the <code>identify</code> function which also takes in the <span>$SCM$</span>:</p><pre><code class="language-julia hljs">statistical_iate = identify(iate, scm)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TMLE.StatisticalIATE
-----
Outcome: Y
Treatment: (T₁ = (case = 1, control = 0), T₂ = (case = 1, control = 0))
</code></pre><p>Alternatively, you can also directly define the statistical parameters (see <a href="../user_guide/estimands/#Estimands">Estimands</a>).</p><h2 id="Estimation"><a class="docs-heading-anchor" href="#Estimation">Estimation</a><a id="Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Estimation" title="Permalink"></a></h2><p>Then each parameter can be estimated by building an estimator (which is simply a function) and calling it on data. For illustration, we will keep the models used simple linear models. We define a TMLE:</p><pre><code class="language-julia hljs">models = (
    Y  = with_encoder(LinearRegressor()),
    T₁ = LogisticClassifier(),
    T₂ = LogisticClassifier()
)
tmle = TMLEE(models)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TMLEE((Y = DeterministicPipeline(treatment_transformer = TreatmentTransformer(encoder = OneHotEncoder(features = Symbol[], …)), …), T₁ = LogisticClassifier(lambda = 2.220446049250313e-16, …), T₂ = LogisticClassifier(lambda = 2.220446049250313e-16, …)), nothing, 1.0e-8, false, nothing)</code></pre><p>And estimate the <code>cm</code> causal parameter. Because we haven&#39;t identified the parameter, we need to provide the <code>scm</code> as well:</p><pre><code class="language-julia hljs">result, cache = tmle(cm, scm, dataset);
result</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌──────────┬─────────────────────────┬─────────────┐
│ Estimate │ 95% Confidence Interval │     P-value │
├──────────┼─────────────────────────┼─────────────┤
│  1.81806 │      (1.64368, 1.99245) │ 5.67125e-78 │
└──────────┴─────────────────────────┴─────────────┘
</code></pre><p>We can estimate statistical parameters directly, let&#39;s use the One-Step estimator:</p><pre><code class="language-julia hljs">ose = OSE(models)
result, cache = ose(statistical_iate, dataset)
result</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌───────────┬─────────────────────────┬───────────┐
│  Estimate │ 95% Confidence Interval │   P-value │
├───────────┼─────────────────────────┼───────────┤
│ -0.559899 │  (-1.10297, -0.0168282) │ 0.0433237 │
└───────────┴─────────────────────────┴───────────┘
</code></pre><h2 id="Hypothesis-Testing"><a class="docs-heading-anchor" href="#Hypothesis-Testing">Hypothesis Testing</a><a id="Hypothesis-Testing-1"></a><a class="docs-heading-anchor-permalink" href="#Hypothesis-Testing" title="Permalink"></a></h2><p>Because the TMLE and OSE are asymptotically linear estimators, they asymptotically follow a Normal distribution. This means one can perform standard T/Z tests of null hypothesis. TMLE.jl extends the method provided by the <a href="https://juliastats.org/HypothesisTests.jl/stable/">HypothesisTests.jl</a> package that can be used as follows.</p><pre><code class="language-julia hljs">OneSampleTTest(result)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">One sample t-test
-----------------
Population details:
    parameter of interest:   Mean
    value under h_0:         0
    point estimate:          -0.559899
    95% confidence interval: (-1.103, -0.01683)

Test summary:
    outcome with 95% confidence: reject h_0
    two-sided p-value:           0.0433

Details:
    number of observations:   1000
    t-statistic:              -2.023148752179201
    degrees of freedom:       999
    empirical standard error: 0.2767463152058187
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../user_guide/scm/">Structural Causal Models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 30 October 2023 19:36">Monday 30 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
