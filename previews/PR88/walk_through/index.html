<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Walk Through · TMLE.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://TARGENE.github.io/TMLE.jl/walk_through/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/logo.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="TMLE.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">TMLE.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Walk Through</a><ul class="internal"><li><a class="tocitem" href="#The-Dataset"><span>The Dataset</span></a></li><li><a class="tocitem" href="#The-Structural-Causal-Model"><span>The Structural Causal Model</span></a></li><li><a class="tocitem" href="#The-Estimands"><span>The Estimands</span></a></li><li><a class="tocitem" href="#Targeted-Estimation"><span>Targeted Estimation</span></a></li><li><a class="tocitem" href="#Hypothesis-Testing"><span>Hypothesis Testing</span></a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../user_guide/scm/">Structural Causal Models</a></li><li><a class="tocitem" href="../user_guide/estimands/">Estimands</a></li><li><a class="tocitem" href="../user_guide/estimation/">Estimation</a></li><li><a class="tocitem" href="../user_guide/adjustment/">Adjustment Methods</a></li><li><a class="tocitem" href="../user_guide/misc/">Miscellaneous</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/super_learning/">Becoming a Super Learner</a></li><li><a class="tocitem" href="../examples/double_robustness/">Model Misspecification &amp; Double Robustness</a></li></ul></li><li><a class="tocitem" href="../resources/">Resources</a></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Walk Through</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Walk Through</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/TARGENE/TMLE.jl/blob/main/docs/src/walk_through.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Walk-Through"><a class="docs-heading-anchor" href="#Walk-Through">Walk Through</a><a id="Walk-Through-1"></a><a class="docs-heading-anchor-permalink" href="#Walk-Through" title="Permalink"></a></h1><p>The goal of this section is to provide a comprehensive (but non-exhaustive) illustration of the estimation process provided in TMLE.jl. For an in-depth explanation, please refer to the User Guide.</p><h2 id="The-Dataset"><a class="docs-heading-anchor" href="#The-Dataset">The Dataset</a><a id="The-Dataset-1"></a><a class="docs-heading-anchor-permalink" href="#The-Dataset" title="Permalink"></a></h2><p>TMLE.jl is compatible with any dataset respecting the <a href="https://tables.juliadata.org/stable/">Tables.jl</a> interface, that is for instance, a <code>NamedTuple</code>, a <code>DataFrame</code>, an <code>Arrow.Table</code> etc... In this section, we will be working with the same dataset all along.</p><p>⚠️ One thing to note is that treatment variables as well as binary outcomes <strong>must</strong> be encoded as <code>categorical</code> variables in the dataset (see <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/working_with_categorical_data/">MLJ Working with categorical data</a>).</p><p>The dataset is generated as follows:</p><pre><code class="language-julia hljs">using TMLE
using Random
using Distributions
using DataFrames
using StableRNGs
using CategoricalArrays
using TMLE
using LogExpFunctions
using MLJLinearModels

function make_dataset(;n=1000)
    rng = StableRNG(123)
    # Confounders
    W₁₁= rand(rng, Uniform(), n)
    W₁₂ = rand(rng, Uniform(), n)
    W₂₁= rand(rng, Uniform(), n)
    W₂₂ = rand(rng, Uniform(), n)
    # Covariates
    C = rand(rng, Uniform(), n)
    # Treatment | Confounders
    T₁ = rand(rng, Uniform(), n) .&lt; logistic.(0.5sin.(W₁₁) .- 1.5W₁₂)
    T₂ = rand(rng, Uniform(), n) .&lt; logistic.(-3W₂₁ - 1.5W₂₂)
    # Target | Confounders, Covariates, Treatments
    Y = 1 .+ 2W₂₁ .+ 3W₂₂ .+ W₁₁ .- 4C.*T₁ .- 2T₂.*T₁.*W₁₂ .+ rand(rng, Normal(0, 0.1), n)
    return DataFrame(
        W₁₁ = W₁₁,
        W₁₂ = W₁₂,
        W₂₁ = W₂₁,
        W₂₂ = W₂₂,
        C   = C,
        T₁  = categorical(T₁),
        T₂  = categorical(T₂),
        Y   = Y
        )
end
dataset = make_dataset()</code></pre><p>Even though the role of a variable (treatment, outcome, confounder, ...) is relative to the problem setting, this dataset can intuitively be decomposed into:</p><ul><li>1 Outcome variable (<span>$Y$</span>).</li><li>2 Treatment variables <span>$(T₁, T₂)$</span> with confounders <span>$(W₁₁, W₁₂)$</span> and <span>$(W₂₁, W₂₂)$</span> respectively.</li><li>1 Extra Covariate variable (<span>$C$</span>).</li></ul><h2 id="The-Structural-Causal-Model"><a class="docs-heading-anchor" href="#The-Structural-Causal-Model">The Structural Causal Model</a><a id="The-Structural-Causal-Model-1"></a><a class="docs-heading-anchor-permalink" href="#The-Structural-Causal-Model" title="Permalink"></a></h2><p>The modeling stage starts from the definition of a Structural Causal Model (<code>SCM</code>). This is simply a list of Structural Equations (<code>SE</code>) describing the relationships between the random variables associated with our problem. See <a href="../user_guide/scm/#Structural-Causal-Models">Structural Causal Models</a> for an in-depth explanation. For our purposes, we will simply define it as follows:</p><pre><code class="language-julia hljs">scm = SCM(
    SE(:Y, [:T₁, :T₂, :W₁₁, :W₁₂, :W₂₁, :W₂₂, :C], with_encoder(LinearRegressor())),
    SE(:T₁, [:W₁₁, :W₁₂], LogisticClassifier()),
    SE(:T₂, [:W₂₁, :W₂₂], LogisticClassifier()),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Structural Causal Model:
-----------------------
Y = f₁(T₁, T₂, W₁₁, W₁₂, W₂₁, W₂₂, C), DeterministicPipeline, fitted=false
T₁ = f₂(W₁₁, W₁₂), LogisticClassifier, fitted=false
T₂ = f₃(W₂₁, W₂₂), LogisticClassifier, fitted=false

</code></pre><hr/><p><strong>NOTE</strong></p><ul><li>Each Structural Equation specifies a child node, its parents and the assumed relationship between them. Here we know the model class from which each variable has been generated but in practice this is usually not the case. Instead we recommend the use of Super Learning / Stacking (see TODO).</li><li>Because the treatment variables are categorical, they need to be encoded to be digested by the downstream models, <code>with_encoder(model)</code> simply creates a <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/linear_pipelines/#Linear-Pipelines">Pipeline</a> equivalent to <code>TreatmentEncoder() |&gt; model</code>.</li><li>At this point, the <code>SCM</code> has no knowledge about the dataset and cannot verify that the models are compatible with the actual data.</li></ul><hr/><h2 id="The-Estimands"><a class="docs-heading-anchor" href="#The-Estimands">The Estimands</a><a id="The-Estimands-1"></a><a class="docs-heading-anchor-permalink" href="#The-Estimands" title="Permalink"></a></h2><p>From the previous causal model we can ask multiple causal questions which are each represented by a distinct estimand. The set of available estimands types can be listed as follow:</p><pre><code class="language-julia hljs">AVAILABLE_ESTIMANDS</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(ConditionalMean, AverageTreatmentEffect, InteractionAverageTreatmentEffect)</code></pre><p>At the moment there are 3 main estimand types we can estimate in TMLE.jl, we provide below a few examples.</p><ul><li>The Interventional Conditional Mean:</li></ul><pre><code class="language-julia hljs">cm = CM(
    scm,
    outcome=:Y,
    treatment=(T₁=1,)
    )</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConditionalMean
-----
Outcome: Y
Treatment: (T₁ = 1,)
</code></pre><ul><li>The Average Treatment Effect:</li></ul><pre><code class="language-julia hljs">total_ate = ATE(
    scm,
    outcome=:Y,
    treatment=(T₁=(case=1, control=0), T₂=(case=1, control=0))
)
marginal_ate_t1 = ATE(
    scm,
    outcome=:Y,
    treatment=(T₁=(case=1, control=0),)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AverageTreatmentEffect
-----
Outcome: Y
Treatment: (T₁ = (case = 1, control = 0),)
</code></pre><ul><li>The Interaction Average Treatment Effect:</li></ul><pre><code class="language-julia hljs">iate = IATE(
    scm,
    outcome=:Y,
    treatment=(T₁=(case=1, control=0), T₂=(case=1, control=0))
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">InteractionAverageTreatmentEffect
-----
Outcome: Y
Treatment: (T₁ = (case = 1, control = 0), T₂ = (case = 1, control = 0))
</code></pre><h2 id="Targeted-Estimation"><a class="docs-heading-anchor" href="#Targeted-Estimation">Targeted Estimation</a><a id="Targeted-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Targeted-Estimation" title="Permalink"></a></h2><p>Then each parameter can be estimated by calling the <code>tmle!</code> function. For example:</p><pre><code class="language-julia hljs">result, _ = tmle!(cm, dataset)
result</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌───────────┬──────────┬─────────────────────────┬─────────────┐
│ Estimator │ Estimate │ 95% Confidence Interval │     P-value │
├───────────┼──────────┼─────────────────────────┼─────────────┤
│      TMLE │  1.81806 │      (1.64368, 1.99245) │ 5.67125e-78 │
│       OSE │  1.81793 │      (1.64353, 1.99234) │ 5.99786e-78 │
│     Naive │  1.83249 │                 nothing │     nothing │
└───────────┴──────────┴─────────────────────────┴─────────────┘
</code></pre><p>The <code>result</code> contains 3 main elements:</p><ul><li>The <code>TMLEEstimate</code> than can be accessed via:</li></ul><pre><code class="language-julia hljs">tmle(result)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌──────────┬─────────────────────────┬─────────────┐
│ Estimate │ 95% Confidence Interval │     P-value │
├──────────┼─────────────────────────┼─────────────┤
│  1.81806 │      (1.64368, 1.99245) │ 5.67125e-78 │
└──────────┴─────────────────────────┴─────────────┘
</code></pre><ul><li>The <code>OSEstimate</code> than can be accessed via:</li></ul><pre><code class="language-julia hljs">ose(result)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌──────────┬─────────────────────────┬─────────────┐
│ Estimate │ 95% Confidence Interval │     P-value │
├──────────┼─────────────────────────┼─────────────┤
│  1.81793 │      (1.64353, 1.99234) │ 5.99786e-78 │
└──────────┴─────────────────────────┴─────────────┘
</code></pre><ul><li>The naive initial estimate.</li></ul><pre><code class="language- hljs">naive(result)</code></pre><p>The adjustment set is determined by the provided <code>adjustment_method</code> keyword. At the moment, only <code>BackdoorAdjustment</code> is available. However one can specify that extra covariates could be used to fit the outcome model.</p><pre><code class="language-julia hljs">result, _ = tmle!(iate, dataset;adjustment_method=BackdoorAdjustment([:C]))
result</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌───────────┬─────────────┬─────────────────────────┬─────────────┐
│ Estimator │    Estimate │ 95% Confidence Interval │     P-value │
├───────────┼─────────────┼─────────────────────────┼─────────────┤
│      TMLE │   -0.517802 │     (-1.28175, 0.24614) │    0.183795 │
│       OSE │    -0.72492 │   (-1.09281, -0.357028) │ 0.000117437 │
│     Naive │ 6.12843e-17 │                 nothing │     nothing │
└───────────┴─────────────┴─────────────────────────┴─────────────┘
</code></pre><h2 id="Hypothesis-Testing"><a class="docs-heading-anchor" href="#Hypothesis-Testing">Hypothesis Testing</a><a id="Hypothesis-Testing-1"></a><a class="docs-heading-anchor-permalink" href="#Hypothesis-Testing" title="Permalink"></a></h2><p>Because the TMLE and OSE are asymptotically linear estimators, they asymptotically follow a Normal distribution. This means one can perform standard T tests of null hypothesis. TMLE.jl extends the method provided by the <a href="https://juliastats.org/HypothesisTests.jl/stable/">HypothesisTests.jl</a> package that can be used as follows.</p><pre><code class="language-julia hljs">OneSampleTTest(tmle(result))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">One sample t-test
-----------------
Population details:
    parameter of interest:   Mean
    value under h_0:         0
    point estimate:          -0.517802
    95% confidence interval: (-1.282, 0.2461)

Test summary:
    outcome with 95% confidence: fail to reject h_0
    two-sided p-value:           0.1838

Details:
    number of observations:   1000
    t-statistic:              -1.3300805151611914
    degrees of freedom:       999
    empirical standard error: 0.3893016023864806
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../user_guide/scm/">Structural Causal Models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 11 August 2023 14:18">Friday 11 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
