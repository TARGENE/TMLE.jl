<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · TMLE.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://olivierlabayle.github.io/TMLE.jl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>TMLE.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Get-in-touch"><span>Get in touch</span></a></li><li><a class="tocitem" href="#Tutorials"><span>Tutorials</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/olivierlabayle/TMLE.jl/blob/master/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="TMLE"><a class="docs-heading-anchor" href="#TMLE">TMLE</a><a id="TMLE-1"></a><a class="docs-heading-anchor-permalink" href="#TMLE" title="Permalink"></a></h1><p>The purpose of this package is to provide convenience methods for  Targeted Minimum Loss-Based Estimation (TMLE). TMLE is a framework for efficient estimation that was first proposed by Van der Laan et al in 2006. If you are new to TMLE, this <a href="https://www.hindawi.com/journals/as/2014/502678/">review paper</a>  gives a nice overview to the field. Because TMLE requires nuisance parameters  to be learnt by machine learning algorithms, this package is built on top of  <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/">MLJ</a>. This means that any model  respecting the MLJ interface can be used to estimate the nuisance parameters.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This package is still experimental and documentation under construction</p></div></div><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>The package is not yet part of the registry and must be installed via github:</p><pre><code class="language-julia hljs">julia&gt; ]add https://github.com/olivierlabayle/TMLE.jl</code></pre><h2 id="Get-in-touch"><a class="docs-heading-anchor" href="#Get-in-touch">Get in touch</a><a id="Get-in-touch-1"></a><a class="docs-heading-anchor-permalink" href="#Get-in-touch" title="Permalink"></a></h2><p>Please feel free to fill an issue if you want to report any bug or want to have additional features part of the package.  Contributing is also welcome.</p><h2 id="Tutorials"><a class="docs-heading-anchor" href="#Tutorials">Tutorials</a><a id="Tutorials-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorials" title="Permalink"></a></h2><p>This package is built on top of MLJ, if you are new to the MLJ framework,  please refer first to their <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/">documentation</a>.</p><p>Currently, two parameters of the generating distribution are available for estimation, the Average Treatment Effect (ATE) and the Interaction Average  Treatment Effect (IATE). For both quantities, a graphical representation of the  underlying causal model in presented bellow.</p><p><img src="img/causal_model.png" alt="causal_model.png"/></p><p>TMLE is a two steps procedure, it first starts by estimating nuisance  parameters that will be used to build the final estimator. They are called nuisance parameters because they are required for estimation but are not our target quantity of interest.  For both the ATE and IATE, the nuisance parameters that require a learning algorithm are:</p><ul><li>The conditional extectation of the target </li><li>The conditional density of the treatment</li></ul><p>They are typically estimated by stacking which is built into MLJ and you can find more information about it <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/composing_models/#Model-Stacking">here</a>. Stacking is not compulsory however and any model  respecting the <a href="https://github.com/JuliaAI/MLJModelInterface.jl">MLJ Interface</a> should work out of the box.</p><p>In the second stage, TMLE fluctuates a nuisance parameter using a parametric model in order to solve the efficient influence curve equation. For now, this is done via a  Generalized Linear model and the nuisance parameter which is fluctuated is the conditional extectation of the target variable.</p><p>For those examples, we will need the following packages:</p><pre><code class="language-julia hljs">using Random
using Distributions
using MLJ
using TMLE</code></pre><h3 id="ATE"><a class="docs-heading-anchor" href="#ATE">ATE</a><a id="ATE-1"></a><a class="docs-heading-anchor-permalink" href="#ATE" title="Permalink"></a></h3><p>Let&#39;s consider the following example:</p><ul><li>W = [W<em>1, W</em>2, W_3] is a set of binary confounding variables, W ~ Bernoulli(0.5)</li><li>T is a Binary variable, p(T=1|W=w) = expit(0.5W<em>1</em> + 1.5W<em>2 - W</em>3)</li><li>Y is a Continuous variable, Y = T + 2W<em>1 + 3W</em>2 - 4W_3 + \epsilon(0, 1)</li></ul><pre><code class="language-julia hljs">n = 10000
rng = MersenneTwister(0)
# Sampling
Unif = Uniform(0, 1)
W = float(rand(rng, Bernoulli(0.5), n, 3))
t = rand(rng, Unif, n) .&lt; expit(0.5W[:, 1] + 1.5W[:, 2] - W[:,3])
y = t + 2W[:, 1] + 3W[:, 2] - 4W[:, 3] + rand(rng, Normal(0, 1), n)
# W needs to respect the Tables.jl interface.
# t is a binary categorical vector
W = MLJ.table(W)
t = categorical(t)</code></pre><p>We need to define 2 estimators for the nuisance parameters, usually this is  done using the Stack but here because we know the generating process we can  cheat a bit. We will use a Logistic Classifier for p(T|W) and a Constant Regressor for p(Y|W, T). This means one estimator is well specified and the other not.  The target is continuous thus we will use a Linear regression model  for the fluctuation. This is done by specifying a Normal distribution for the  Generalized Linear Model.</p><pre><code class="language-julia hljs">
LogisticClassifier = @load LogisticClassifier pkg=MLJLinearModels verbosity=0

tmle = ATEEstimator(LogisticClassifier(),
                    MLJ.DeterministicConstantRegressor(),
                    Normal())
</code></pre><p>Now, all there is to do is to fit the estimator:</p><pre><code class="language-julia hljs">fitresult, _, _ = MLJ.fit(tmle, 0, t, W, y)</code></pre><p>The <code>fitresult</code> contains the estimate and the associated standard error.</p><p>### IATE</p><p>TODO.</p><p>## API </p><article class="docstring"><header><a class="docstring-binding" id="TMLE.ATEEstimator" href="#TMLE.ATEEstimator"><code>TMLE.ATEEstimator</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ATEEstimator(target_cond_expectation_estimator, 
            treatment_cond_likelihood_estimator,
            fluctuation_family)</code></pre><p># Scope:</p><p>Implements the Targeted Minimum Loss-Based Estimator for the Average Treatment Effect (ATE). The Average Treatment Effect is defined as: ATE = E[E[Y|T=1, W=w] - E[Y|T=0, W=w]], where:</p><ul><li>Y is the target variable (Binary)</li><li>T is the treatment variable (Binary)</li><li>W are confounder variables</li></ul><p>The TMLE procedure relies on plugin estimation. Here, the ATE requires an  estimator of t,w → E[Y|T=t, W=w], an estimator of w → p(T|w) and an estimator of w → p(w). The empirical distribution will be used for w → p(w) all along.  The estimator of t,w → E[Y|T=t, W=w] is then fluctuated to solve the efficient influence curve equation. </p><p>More information can be found about TMLE in &quot;Causal Inference for Observational and Experimental Data&quot; by Mark J. van der Laan and Sherri Rose.</p><p><strong>Arguments:</strong></p><ul><li>target<em>cond</em>expectation_estimator::MLJ.Supervised : The learner to be used</li></ul><p>for E[Y|W, T]. Typically a <code>MLJ.Stack</code>.</p><ul><li>treatment<em>cond</em>likelihood_estimator::MLJ.Supervised : The learner to be used</li></ul><p>for p(T|W). Typically a <code>MLJ.Stack</code>.</p><ul><li>fluctuation_family::Distribution : This will be used to build the fluctuation </li></ul><p>using a GeneralizedLinearModel. Typically <code>Normal</code> for a continuous target  and <code>Bernoulli</code> for a Binary target.</p><p># Examples:</p><p>TODO</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/olivierlabayle/TMLE.jl/blob/7acc3c4d58f47b809e40b80f3290d68d7033d64e/src/ate.jl#L2-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TMLE.InteractionATEEstimator" href="#TMLE.InteractionATEEstimator"><code>TMLE.InteractionATEEstimator</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">InteractionATEEstimator(target_cond_expectation_estimator,
                        treatment_cond_likelihood_estimator,
                        fluctuation_family)</code></pre><p># Scope:</p><p>Implements the Targeted Minimum Loss-Based Estimator for the Interaction  Average Treatment Effect (IATE) defined by Beentjes and Khamseh in https://link.aps.org/doi/10.1103/PhysRevE.102.053314. For instance, The IATE is defined for two treatment variables as: </p><p>IATE = E[E[Y|T₁=1, T₂=1, W=w] - E[E[Y|T₁=1, T₂=0, W=w]         - E[E[Y|T₁=0, T₂=1, W=w] + E[E[Y|T₁=0, T₂=0, W=w]</p><p>where:</p><ul><li>Y is the target variable (Binary)</li><li>T = T₁, T₂ are the treatment variables (Binary)</li><li>W are confounder variables</li></ul><p>The TMLE procedure relies on plugin estimation. Like the ATE, the IATE  requires an estimator of t,w → E[Y|T=t, W=w], an estimator of  w → p(T|w)  and an estimator of w → p(w). The empirical distribution will be used for w → p(w) all along.  The estimator of t,w → E[Y|T=t, W=w] is then fluctuated to solve the efficient influence curve equation. </p><p><strong>Arguments:</strong></p><ul><li>target<em>cond</em>expectation_estimator::MLJ.Supervised : The learner to be used</li></ul><p>for E[Y|W, T]. Typically a <code>MLJ.Stack</code>.</p><ul><li>treatment<em>cond</em>likelihood_estimator::MLJ.Supervised : The learner to be used</li></ul><p>for p(T|W). Typically a <code>MLJ.Stack</code>.</p><ul><li>fluctuation_family::Distribution : This will be used to build the fluctuation </li></ul><p>using a GeneralizedLinearModel. Typically <code>Normal</code> for a continuous target  and <code>Bernoulli</code> for a Binary target.</p><p># Examples:</p><p>TODO</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/olivierlabayle/TMLE.jl/blob/7acc3c4d58f47b809e40b80f3290d68d7033d64e/src/interaction_ate.jl#L2-L42">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MLJModelInterface.fit-Tuple{InteractionATEEstimator, Int64, Any, Any, Union{Vector{var&quot;#s8&quot;} where var&quot;#s8&quot;&lt;:Real, CategoricalArrays.CategoricalVector{Bool, R, V, C, U} where {R&lt;:Integer, V, C, U}}}" href="#MLJModelInterface.fit-Tuple{InteractionATEEstimator, Int64, Any, Any, Union{Vector{var&quot;#s8&quot;} where var&quot;#s8&quot;&lt;:Real, CategoricalArrays.CategoricalVector{Bool, R, V, C, U} where {R&lt;:Integer, V, C, U}}}"><code>MLJModelInterface.fit</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">MLJ.fit(tmle::InteractionATEEstimator, 
             verbosity::Int, 
             T,
             W, 
             y::Union{CategoricalVector{Bool}, Vector{&lt;:Real}}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/olivierlabayle/TMLE.jl/blob/7acc3c4d58f47b809e40b80f3290d68d7033d64e/src/interaction_ate.jl#L83-L89">source</a></section></article><ul><li><a href="#TMLE.ATEEstimator"><code>TMLE.ATEEstimator</code></a></li><li><a href="#TMLE.InteractionATEEstimator"><code>TMLE.InteractionATEEstimator</code></a></li><li><a href="#MLJModelInterface.fit-Tuple{InteractionATEEstimator, Int64, Any, Any, Union{Vector{var&quot;#s8&quot;} where var&quot;#s8&quot;&lt;:Real, CategoricalArrays.CategoricalVector{Bool, R, V, C, U} where {R&lt;:Integer, V, C, U}}}"><code>MLJModelInterface.fit</code></a></li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.5 on <span class="colophon-date" title="Wednesday 4 August 2021 13:24">Wednesday 4 August 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
